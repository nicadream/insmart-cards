<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>–°–ª–∞–π–¥–µ—Ä –≤–∏–∑–∏—Ç–æ–∫</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <style>
    :root {
      --bg: #050711;
      --accent: #5A7CE7;
      --accent2: #E33D8C;
      --txt: #ffffff;
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      height: 100%;
      font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(1200px 800px at 70% 5%, rgba(90,124,231,.45), transparent 60%),
        radial-gradient(900px 700px at 15% 90%, rgba(227,61,140,.35), transparent 60%),
        var(--bg);
      color: var(--txt);
      overflow: hidden;
    }

    .root {
      height: 100vh;
      display: grid;
      place-items: center;
      padding: 12px;
    }

    .slider {
      position: relative;
      width: min(1280px, 100%);
      height: min(720px, 100%);
      border-radius: 24px;
      overflow: hidden;
      background: #000;
      box-shadow: 0 28px 80px rgba(0,0,0,.85);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .slide-img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      background: #000;
      opacity: 0;
      transform: scale(1.01);
      transition: opacity .6s ease, transform .6s ease;
    }

    .slide-img.is-visible {
      opacity: 1;
      transform: scale(1);
    }

    .nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 48px;
      height: 48px;
      border-radius: 999px;
      border: none;
      outline: none;
      background: rgba(5,7,20,.7);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      cursor: pointer;
      box-shadow: 0 8px 30px rgba(0,0,0,.6);
      transition: background .2s ease, transform .1s ease, opacity .2s ease;
      opacity: .85;
      z-index: 5;
    }

    .nav:hover {
      background: rgba(5,7,20,.95);
      transform: translateY(-50%) scale(1.05);
    }

    .nav:active {
      transform: translateY(-50%) scale(.96);
    }

    .nav-left { left: 14px; }
    .nav-right { right: 14px; }

    .dots {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 10px;
      display: flex;
      justify-content: center;
      gap: 8px;
      z-index: 4;
    }

    .dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: rgba(255,255,255,.24);
      transition: width .2s ease, background .2s ease;
    }

    .dot.is-active {
      width: 28px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
    }

    .hint {
      position: fixed;
      left: 8px;
      bottom: 6px;
      padding: 6px 10px;
      border-radius: 10px;
      background: rgba(5,7,20,.8);
      color: rgba(255,255,255,.7);
      font-size: 12px;
      backdrop-filter: blur(8px);
      z-index: 10;
    }

    .status {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      color: rgba(255,255,255,.7);
      text-align: center;
      padding: 16px;
    }

    @media (max-width: 640px) {
      .slider {
        border-radius: 16px;
      }
      .nav {
        width: 36px;
        height: 36px;
        font-size: 22px;
      }
      .nav-left { left: 6px; }
      .nav-right { right: 6px; }
    }
  </style>
</head>
<body>
<div class="root">
  <div class="slider">
    <div id="status" class="status">
      –ó–∞–≥—Ä—É–∂–∞—é –≤–∏–∑–∏—Ç–∫–∏ –∏–∑ –ø–∞–ø–∫–∏ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞‚Ä¶
    </div>
    <img id="slide" class="slide-img" src="" alt="–í–∏–∑–∏—Ç–∫–∞" />
    <button class="nav nav-left" id="btn-prev" aria-label="–ù–∞–∑–∞–¥">‚Äπ</button>
    <button class="nav nav-right" id="btn-next" aria-label="–í–ø–µ—Ä—ë–¥">‚Ä∫</button>
    <div class="dots" id="dots"></div>
  </div>
</div>

<div class="hint">
  –ê–≤—Ç–æ—Å–º–µ–Ω–∞ —Å–ª–∞–π–¥–∞ –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥ ‚Ä¢ –ù–∞–∂–º–∏ ‚óÄ / ‚ñ∂ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
</div>

<script>
  // üëâ –°–Æ–î–ê –í–°–¢–ê–í–¨ –ü–£–ë–õ–ò–ß–ù–£–Æ –°–°–´–õ–ö–£ –ù–ê –ü–ê–ü–ö–£ –Ø–ù–î–ï–ö–°.–î–ò–°–ö–ê
  const PUBLIC_LINK = 'https://disk.yandex.ru/d/XXXXXXXXXXXXXX';

  const IMAGE_EXTS = ['.jpg', '.jpeg', '.png', '.webp'];

  const slideEl  = document.getElementById('slide');
  const dotsEl   = document.getElementById('dots');
  const btnPrev  = document.getElementById('btn-prev');
  const btnNext  = document.getElementById('btn-next');
  const statusEl = document.getElementById('status');

  const INTERVAL = 15000; // 15 —Å–µ–∫—É–Ω–¥
  let IMAGE_URLS = [];
  let current = 0;
  let timer   = null;

  function setStatus(text) {
    if (!statusEl) return;
    statusEl.textContent = text;
  }

  function hideStatus() {
    if (statusEl) {
      statusEl.remove();
    }
  }

  function renderDots() {
    dotsEl.innerHTML = '';
    IMAGE_URLS.forEach((_, i) => {
      const d = document.createElement('div');
      d.className = 'dot' + (i === current ? ' is-active' : '');
      dotsEl.appendChild(d);
    });
  }

  function showSlide(index) {
    if (!IMAGE_URLS.length) return;
    current = (index + IMAGE_URLS.length) % IMAGE_URLS.length;
    const url = IMAGE_URLS[current];

    slideEl.classList.remove('is-visible');

    setTimeout(() => {
      slideEl.src = url;
    }, 80);
  }

  slideEl.addEventListener('load', () => {
    slideEl.classList.add('is-visible');
    renderDots();
  });

  function next() {
    showSlide(current + 1);
  }

  function prev() {
    showSlide(current - 1);
  }

  function startTimer() {
    clearInterval(timer);
    timer = setInterval(next, INTERVAL);
  }

  btnNext.addEventListener('click', () => {
    next();
    startTimer();
  });

  btnPrev.addEventListener('click', () => {
    prev();
    startTimer();
  });

  window.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowRight') {
      next();
      startTimer();
    } else if (e.key === 'ArrowLeft') {
      prev();
      startTimer();
    }
  });

  const sliderEl = document.querySelector('.slider');
  sliderEl.addEventListener('mouseenter', () => clearInterval(timer));
  sliderEl.addEventListener('mouseleave', () => startTimer());

  let touchX = null;
  sliderEl.addEventListener('touchstart', (e) => {
    touchX = e.touches[0].clientX;
  }, { passive: true });

  sliderEl.addEventListener('touchend', (e) => {
    if (touchX == null) return;
    const dx = e.changedTouches[0].clientX - touchX;
    touchX = null;
    if (Math.abs(dx) < 40) return;
    if (dx < 0) next(); else prev();
    startTimer();
  }, { passive: true });

  // --- –ó–ê–ì–†–£–ó–ö–ê –°–ü–ò–°–ö–ê –§–ê–ô–õ–û–í –ò–ó –Ø–ù–î–ï–ö–°.–î–ò–°–ö–ê ---

  async function loadImagesFromYandex() {
    if (!PUBLIC_LINK || PUBLIC_LINK.includes('XXXXXXXX')) {
      setStatus('–£–∫–∞–∂–∏ PUBLIC_LINK ‚Äî –ø—É–±–ª–∏—á–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –ø–∞–ø–∫—É —Å –≤–∏–∑–∏—Ç–∫–∞–º–∏.');
      return;
    }

    try {
      const apiUrl =
        'https://cloud-api.yandex.net/v1/disk/public/resources' +
        '?public_key=' + encodeURIComponent(PUBLIC_LINK) +
        '&limit=1000' +
        '&preview_size=XL' +
        '&preview_crop=true';

      const res = await fetch(apiUrl);
      if (!res.ok) {
        throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + res.status);
      }

      const data = await res.json();
      console.log('Yandex data:', data);

      let items = [];

      // –ï—Å–ª–∏ –ø–æ —Å—Å—ã–ª–∫–µ –æ–¥–∏–Ω —Ñ–∞–π–ª
      if (data.type === 'file') {
        items = [data];
      }
      // –ï—Å–ª–∏ –ø–∞–ø–∫–∞ ‚Äî —É –Ω–µ—ë –≤–Ω—É—Ç—Ä–∏ _embedded.items
      else if (data._embedded && Array.isArray(data._embedded.items)) {
        items = data._embedded.items;
      }

      if (!items.length) {
        setStatus('–í —Ä–µ—Å—É—Ä—Å–µ –ø–æ —Å—Å—ã–ª–∫–µ –Ω–µ—Ç —Ñ–∞–π–ª–æ–≤. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ PUBLIC_LINK ‚Äî —ç—Ç–æ –∏–º–µ–Ω–Ω–æ –ø–∞–ø–∫–∞ –∏–ª–∏ —Ñ–∞–π–ª —Å –≤–∏–∑–∏—Ç–∫–∞–º–∏.');
        return;
      }

      const images = items.filter(item => {
        if (item.type !== 'file') return false;
        const name = (item.name || '').toLowerCase();
        return IMAGE_EXTS.some(ext => name.endsWith(ext));
      });

      if (!images.length) {
        setStatus('–ù–µ –Ω–∞–π–¥–µ–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏: ' + IMAGE_EXTS.join(', '));
        return;
      }

      IMAGE_URLS = images
        .map(item => {
          // 1) –ø—Ä—è–º–æ–π —Ñ–∞–π–ª, –µ—Å–ª–∏ –Ø–Ω–¥–µ–∫—Å –¥–∞–ª
          if (item.file) return item.file;
          // 2) –ø—Ä–µ–≤—å—é (cloud-api –≤—Å–µ–≥–¥–∞ —É–º–µ–µ—Ç –∏—Ö –¥–µ–ª–∞—Ç—å)
          if (item.preview) return item.preview;
          // 3) –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π
          if (item._links && item._links.self && item._links.self.href) {
            return item._links.self.href;
          }
          return null;
        })
        .filter(Boolean);

      if (!IMAGE_URLS.length) {
        setStatus('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–∞–π–ª—ã. –ü—Ä–æ–≤–µ—Ä—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.');
        return;
      }

      hideStatus();
      showSlide(0);
      startTimer();

    } catch (err) {
      console.error(err);
      setStatus('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–∑–∏—Ç–∫–∏. –í–æ–∑–º–æ–∂–Ω–æ, –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫ —Ä–µ–∂–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞ (CORS).');
    }
  }

  loadImagesFromYandex();
</script>
</body>
</html>

